{
  "version": 3,
  "sources": ["../../routes/articles.ts"],
  "sourcesContent": ["import Router, {RouterContext} from \"koa-router\";\nimport bodyParser from \"koa-bodyparser\";\nimport * as model from \"../models/articles\";\nimport { validateArticle } from \"../controllers/validation\";\nimport { basicAuth } from \"../controllers/auth\";\n\nconst articles = [\n  {title: 'Hello article', fullText: 'some text to fill the body'},\n  {title: 'another article', fullText: 'again here is some text here to fill'},\n  {title: 'coventry university', fullText: 'some news about coventry university'},\n  {title: 'smart campus', fullText: 'smart campus is coming to IVE'}\n];\n\nconst router = new Router({prefix: '/api/v1/articles'});\n\nconst getAll = async (ctx: RouterContext, next: any) => {\n  //ctx.body = articles;\n  let articles = await model.getAll();\n  if(articles.length) {\n    ctx.body = articles;\n  } else {\n    ctx.body = {};\n  }\n  await next();\n}\n\nconst createArticle = async (ctx: RouterContext, next: any) => {\n  /*let c: any = ctx.request.body;\n  let title = c.title;\n  let fullText = c.fullText;\n  let newArticle = {title: title, fullText: fullText};\n  articles.push(newArticle);\n  ctx.status = 201;\n  ctx.body = newArticle;*/\n  const body = ctx.request.body;\n  let result = await model.add(body);\n  if(result.status==201) {\n    ctx.status = 201;\n    ctx.body = body;\n  } else {\n    ctx.status = 500;\n    ctx.body = {err: \"insert data failed\"};\n  }\n  await next();\n}\n\nconst getById = async (ctx: RouterContext, next: any) => {\n  let id = +ctx.params.id;\n  /*if((id < articles.length +1) && (id>0)){\n    ctx.body = articles[id-1];\n  } else {\n    ctx.status = 404;\n  }*/\n  let article = await model.getById(id);\n  if(article.length) {\n    ctx.body = article[0];\n  } else {\n    ctx.status = 404;\n  }\n  await next();\n}\n\nconst updateArticle = async (ctx: RouterContext, next: any) => {\n  let id = +ctx.params.id;\n  //let {title, fullText} = ctx.request.body;\n  let c: any = ctx.request.body;\n  let title = c.title;\n  let fullText = c.fullText;\n  if ((id < articles.length+1) && (id > 0)) {\n    articles[id-1].title = title;\n    articles[id-1].fullText = fullText;\n    ctx.status = 200;    \n    ctx.body = articles;\n  } else {\n    ctx.status = 404;\n  }\n  await next();\n}\n\nconst deleteArticle = async (ctx: RouterContext, next: any) => {\n  let id = +ctx.params.id;\n  if((id < articles.length+1) && (id > 0)) {\n    articles.splice(id-1, 1);\n    ctx.status = 200;\n    ctx.body = articles;\n  } else {\n    ctx.status = 404;\n  }\n  await next();\n}\n\nrouter.get('/', getAll);\nrouter.post('/', basicAuth, bodyParser(), validateArticle, createArticle);\nrouter.get('/:id([0-9]{1,})', getById);\nrouter.put('/:id([0-9]{1,})', basicAuth, bodyParser(), updateArticle);\nrouter.delete('/:id([0-9]{1,})', basicAuth, deleteArticle);\n\nexport { router };\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAAoC;AACpC,4BAAuB;AACvB,YAAuB;AACvB,wBAAgC;AAChC,kBAA0B;AAE1B,MAAM,WAAW;AAAA,EACf,EAAC,OAAO,iBAAiB,UAAU,6BAA4B;AAAA,EAC/D,EAAC,OAAO,mBAAmB,UAAU,uCAAsC;AAAA,EAC3E,EAAC,OAAO,uBAAuB,UAAU,sCAAqC;AAAA,EAC9E,EAAC,OAAO,gBAAgB,UAAU,gCAA+B;AACnE;AAEA,MAAM,SAAS,IAAI,kBAAAA,QAAO,EAAC,QAAQ,mBAAkB,CAAC;AAEtD,MAAM,SAAS,OAAO,KAAoB,SAAc;AAEtD,MAAIC,YAAW,MAAM,MAAM,OAAO;AAClC,MAAGA,UAAS,QAAQ;AAClB,QAAI,OAAOA;AAAA,EACb,OAAO;AACL,QAAI,OAAO,CAAC;AAAA,EACd;AACA,QAAM,KAAK;AACb;AAEA,MAAM,gBAAgB,OAAO,KAAoB,SAAc;AAQ7D,QAAM,OAAO,IAAI,QAAQ;AACzB,MAAI,SAAS,MAAM,MAAM,IAAI,IAAI;AACjC,MAAG,OAAO,UAAQ,KAAK;AACrB,QAAI,SAAS;AACb,QAAI,OAAO;AAAA,EACb,OAAO;AACL,QAAI,SAAS;AACb,QAAI,OAAO,EAAC,KAAK,qBAAoB;AAAA,EACvC;AACA,QAAM,KAAK;AACb;AAEA,MAAM,UAAU,OAAO,KAAoB,SAAc;AACvD,MAAI,KAAK,CAAC,IAAI,OAAO;AAMrB,MAAI,UAAU,MAAM,MAAM,QAAQ,EAAE;AACpC,MAAG,QAAQ,QAAQ;AACjB,QAAI,OAAO,QAAQ;AAAA,EACrB,OAAO;AACL,QAAI,SAAS;AAAA,EACf;AACA,QAAM,KAAK;AACb;AAEA,MAAM,gBAAgB,OAAO,KAAoB,SAAc;AAC7D,MAAI,KAAK,CAAC,IAAI,OAAO;AAErB,MAAI,IAAS,IAAI,QAAQ;AACzB,MAAI,QAAQ,EAAE;AACd,MAAI,WAAW,EAAE;AACjB,MAAK,KAAK,SAAS,SAAO,KAAO,KAAK,GAAI;AACxC,aAAS,KAAG,GAAG,QAAQ;AACvB,aAAS,KAAG,GAAG,WAAW;AAC1B,QAAI,SAAS;AACb,QAAI,OAAO;AAAA,EACb,OAAO;AACL,QAAI,SAAS;AAAA,EACf;AACA,QAAM,KAAK;AACb;AAEA,MAAM,gBAAgB,OAAO,KAAoB,SAAc;AAC7D,MAAI,KAAK,CAAC,IAAI,OAAO;AACrB,MAAI,KAAK,SAAS,SAAO,KAAO,KAAK,GAAI;AACvC,aAAS,OAAO,KAAG,GAAG,CAAC;AACvB,QAAI,SAAS;AACb,QAAI,OAAO;AAAA,EACb,OAAO;AACL,QAAI,SAAS;AAAA,EACf;AACA,QAAM,KAAK;AACb;AAEA,OAAO,IAAI,KAAK,MAAM;AACtB,OAAO,KAAK,KAAK,2BAAW,sBAAAC,SAAW,GAAG,mCAAiB,aAAa;AACxE,OAAO,IAAI,mBAAmB,OAAO;AACrC,OAAO,IAAI,mBAAmB,2BAAW,sBAAAA,SAAW,GAAG,aAAa;AACpE,OAAO,OAAO,mBAAmB,uBAAW,aAAa;",
  "names": ["Router", "articles", "bodyParser"]
}
